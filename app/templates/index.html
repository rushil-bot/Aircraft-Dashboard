<!DOCTYPE html>
<html>
<head>
    <title>SFO {{ label }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 1em; }
        th { background-color: #f2f2f2; }
        .delayed { color: #e51a1a; font-style: italic; font-weight: bold;}
        .early { color: #228822; font-style: normal; font-weight: bold;}
        .cancelled { color: #6d0e0e; font-style: italic; font-weight: bold;}
        .nav { font-size: 0.8em; }
        a { color: #0074d9; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="nav"><a href="/">Home</a></div>
    <h1>SFO {{ label }}</h1>
    <table>
        <tr>
            <th>Airline</th>
            <th>Flight</th>
            <th>Origin/Destination</th>
            <th>Status</th>
            <th>Scheduled</th>
            <th>Actual</th>
            <th>Gate</th>
        </tr>
        {% for item in flights %}
        <tr>
            <td>{{ item.airline }}</td>
            <td>{{ item.flight }}</td>
            <td>{{ item.origin }}</td>
            <td class="status-cell"
                data-status="{{ item.status|lower }}">
              
              {{ item.status }}
            </td>
            <td>{{ item.scheduled_time }}</td>
            <td class="actual-cell"
                data-scheduled="{{ item.scheduled_time }}"
                data-actual="{{ item.actual_time }}"
                data-status="{{ item.status|lower }}">
                {{ item.actual_time }}
            </td>
            <td>{{ item.gate }}</td>
        </tr>
        {% endfor %}
    </table>
  <script>
  function parseTime(t) {
      if (!t) return null;
      t = t.trim();
      if (t === "" || t.toLowerCase() === "n/a") return null;
      let ampm = t.match(/am|pm/i);
      let [h, m] = t.replace(/(am|pm)/ig, "").split(":").map(x => x.trim());
      h = parseInt(h, 10);
      m = parseInt(m, 10);
      if (ampm) {
          if (ampm[0].toLowerCase() === "pm" && h < 12) h += 12;
          if (ampm[0].toLowerCase() === "am" && h === 12) h = 0;
      }
      return h * 60 + m;
  }

  document.querySelectorAll('tr').forEach(tr => {
      const statusCell = tr.querySelector('.status-cell');
      const actualCell = tr.querySelector('.actual-cell');

      if (!statusCell || !actualCell) return;

      const status = (statusCell.dataset.status || "").toLowerCase();
      const scheduled = actualCell.dataset.scheduled;
      const actual = actualCell.dataset.actual;

      // Highlight both status and actual cell if delayed
      if (status.includes('delay')) {
          statusCell.classList.add('delayed');
          actualCell.classList.add('delayed');
      } 
      else if (status.includes('cancelled')){
        statusCell.classList.add('cancelled');
      }
      else {
          let schedMin = parseTime(scheduled);
          let actualMin = parseTime(actual);
          if (schedMin !== null && actualMin !== null) {
              let diff = schedMin - actualMin;
              if (diff > 15) {
                  actualCell.classList.add('early');
                  statusCell.classList.add('early');
                  statusCell.innerHTML = `${statusCell.textContent} / <span style="font-style: italic;">Early</span>`;
              }
          }
      }
  });
  </script>

</body>
</html>
